#!/bin/bash
# Simple internet connectivity checker for Waybar
# Outputs "!" with tooltip if no internet, nothing if online
TIMEOUT=2
CONNECTIVITY_URL="http://connectivity-check.ubuntu.com/generate_204"

# Get default route interface
IFACE=$(ip -o route show default 2>/dev/null | awk '{print $5; exit}')

# If no interface or no IP, output nothing (already shown as disconnected by main module)
if [[ -z "$IFACE" ]]; then
    exit 0
fi

IP=$(ip -4 addr show "$IFACE" 2>/dev/null | awk '/inet / {print $2; exit}')
if [[ -z "$IP" ]]; then
    exit 0
fi

# Check internet connectivity
if ! curl -fsS --max-time $TIMEOUT "$CONNECTIVITY_URL" >/dev/null 2>&1; then
    printf '{"text":"ï± ","tooltip":"No Internet connection"}\n'
fi
